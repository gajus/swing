{"version":3,"sources":["card.js"],"names":[],"mappings":"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","file":"card.js","sourcesContent":["import _ from 'lodash';\nimport Sister from 'sister';\nimport Hammer from 'hammerjs';\nimport rebound from 'rebound';\nimport vendorPrefix from 'vendor-prefix';\nimport raf from 'raf';\nimport {\n    elementChildren,\n    isTouchDevice\n} from './util';\n\n/**\n * @param {Stack} stack\n * @param {HTMLElement} targetElement\n * @return {Object} An instance of Card.\n */\nconst Card = (stack, targetElement) => {\n    let card,\n        config,\n        currentX,\n        currentY,\n        doMove,\n        eventEmitter,\n        isDraging,\n        lastThrow,\n        lastTranslate,\n        lastX,\n        lastY,\n        mc,\n        onSpringUpdate,\n        springSystem,\n        springThrowIn,\n        springThrowOut,\n        throwOutDistance,\n        throwWhere;\n\n    const construct = () => {\n        card = {};\n        config = Card.makeConfig(stack.getConfig());\n        eventEmitter = Sister();\n        springSystem = stack.getSpringSystem();\n        springThrowIn = springSystem.createSpring(250, 10);\n        springThrowOut = springSystem.createSpring(500, 20);\n        lastThrow = {};\n        lastTranslate = {\n            x: 0,\n            y: 0\n        };\n\n        springThrowIn.setRestSpeedThreshold(0.05);\n        springThrowIn.setRestDisplacementThreshold(0.05);\n\n        springThrowOut.setRestSpeedThreshold(0.05);\n        springThrowOut.setRestDisplacementThreshold(0.05);\n\n        throwOutDistance = config.throwOutDistance(config.minThrowOutDistance, config.maxThrowOutDistance);\n\n        mc = new Hammer.Manager(targetElement, {\n            recognizers: [\n                [\n                    Hammer.Pan,\n                    {\n                        threshold: 2\n                    }\n                ]\n            ]\n        });\n\n        Card.appendToParent(targetElement);\n\n        eventEmitter.on('panstart', () => {\n            Card.appendToParent(targetElement);\n\n            eventEmitter.trigger('dragstart', {\n                target: targetElement\n            });\n\n            currentX = 0;\n            currentY = 0;\n\n            isDraging = true;\n\n            (function animation () {\n                if (isDraging) {\n                    doMove();\n\n                    raf(animation);\n                }\n            })();\n        });\n\n        eventEmitter.on('panmove', (e) => {\n            currentX = e.deltaX;\n            currentY = e.deltaY;\n        });\n\n        eventEmitter.on('panend', (e) => {\n            isDraging = false;\n\n            const x = lastTranslate.x + e.deltaX;\n            const y = lastTranslate.y + e.deltaY;\n\n            if (config.isThrowOut(x, targetElement, config.throwOutConfidence(x, y, targetElement))) {\n                card.throwOut(x, y);\n            } else {\n                card.throwIn(x, y);\n            }\n\n            eventEmitter.trigger('dragend', {\n                target: targetElement\n            });\n        });\n\n        // \"mousedown\" event fires late on touch enabled devices, thus listening\n        // to the touchstart event for touch enabled devices and mousedown otherwise.\n        if (isTouchDevice()) {\n            targetElement.addEventListener('touchstart', () => {\n                eventEmitter.trigger('panstart');\n            });\n\n            // Disable scrolling while dragging the element on the touch enabled devices.\n            // @see http://stackoverflow.com/a/12090055/368691\n            (() => {\n                let dragging;\n\n                targetElement.addEventListener('touchstart', () => {\n                    dragging = true;\n                });\n\n                targetElement.addEventListener('touchend', () => {\n                    dragging = false;\n                });\n\n                global.addEventListener('touchmove', (e) => {\n                    if (dragging) {\n                        e.preventDefault();\n                    }\n                });\n            })();\n        } else {\n            targetElement.addEventListener('mousedown', () => {\n                eventEmitter.trigger('panstart');\n            });\n        }\n\n        mc.on('panmove', (e) => {\n            eventEmitter.trigger('panmove', e);\n        });\n\n        mc.on('panend', (e) => {\n            eventEmitter.trigger('panend', e);\n        });\n\n        springThrowIn.addListener({\n            onSpringUpdate: (spring) => {\n                const value = spring.getCurrentValue();\n                const x = rebound.MathUtil.mapValueInRange(value, 0, 1, lastThrow.fromX, 0);\n                const y = rebound.MathUtil.mapValueInRange(value, 0, 1, lastThrow.fromY, 0);\n\n                onSpringUpdate(x, y);\n            },\n            onSpringAtRest: () => {\n                eventEmitter.trigger('throwinend', {\n                    target: targetElement\n                });\n            }\n        });\n\n        springThrowOut.addListener({\n            onSpringUpdate: (spring) => {\n                const value = spring.getCurrentValue();\n                const x = rebound.MathUtil.mapValueInRange(value, 0, 1, lastThrow.fromX, throwOutDistance * lastThrow.direction);\n                const y = lastThrow.fromY;\n\n                onSpringUpdate(x, y);\n            },\n            onSpringAtRest: () => {\n                eventEmitter.trigger('throwoutend', {\n                    target: targetElement\n                });\n            }\n        });\n\n        /**\n         * Transforms card position based on the current environment variables.\n         *\n         * @return {undefined}\n         */\n        doMove = () => {\n            let r,\n                x,\n                y,\n                direction\n                ;\n\n            if (currentX === lastX && currentY === lastY) {\n                return;\n            }\n\n            lastX = currentX;\n            lastY = currentY;\n\n            x = lastTranslate.x + currentX;\n            y = lastTranslate.y + currentY;\n            r = config.rotation(x, y, targetElement, config.maxRotation);\n\n            config.transform(targetElement, x, y, r);\n\n            if (Math.abs(y) > 1.1 * Math.abs(x) ) {\n                direction = y > 0 ? Card.DIRECTION_DOWN : Card.DIRECTION_UP;\n            } else {\n                direction = x < 0 ? Card.DIRECTION_LEFT : Card.DIRECTION_RIGHT;\n            }\n\n            eventEmitter.trigger('dragmove', {\n                target: targetElement,\n                throwOutConfidence: config.throwOutConfidence(x, y, targetElement),\n                throwDirection: direction,\n                offset: x\n            });\n        };\n\n        /**\n         * Invoked every time the physics solver updates the Spring's value.\n         *\n         * @param {Number} x\n         * @param {Number} y\n         * @return {undefined}\n         */\n        onSpringUpdate = (x, y) => {\n            let r;\n\n            r = config.rotation(x, y, targetElement, config.maxRotation);\n\n            lastTranslate.x = x || 0;\n            lastTranslate.y = y || 0;\n\n            Card.transform(targetElement, x, y, r);\n        };\n\n        /**\n         * @param {Card.THROW_IN|Card.THROW_OUT} where\n         * @param {Number} fromX\n         * @param {Number} fromY\n         * @return {undefined}\n         */\n        throwWhere = (where, fromX, fromY) => {\n            lastThrow.fromX = fromX;\n            lastThrow.fromY = fromY;\n\n            if (Math.abs(fromY) > 1.2 * Math.abs(fromX) ) {\n                lastThrow.direction = fromY > 0 ? Card.DIRECTION_DOWN : Card.DIRECTION_UP;\n            }\n            else {\n                lastThrow.direction = fromX < 0 ? Card.DIRECTION_LEFT : Card.DIRECTION_RIGHT;\n            }\n\n            if (where === Card.THROW_IN) {\n                springThrowIn.setCurrentValue(0).setAtRest().setEndValue(1);\n\n                eventEmitter.trigger('throwin', {\n                    target: targetElement,\n                    throwDirection: lastThrow.direction\n                });\n            } else if (where === Card.THROW_OUT) {\n                springThrowOut.setCurrentValue(0).setAtRest().setVelocity(100).setEndValue(1);\n\n                eventEmitter.trigger('throwout', {\n                    target: targetElement,\n                    lastThrow: lastThrow,\n                    throwDirection: lastThrow.direction\n                });\n\n                let eventName;\n                switch(lastThrow.direction) {\n                    case Card.DIRECTION_LEFT: eventName = 'throwoutleft'; break;\n                    case Card.DIRECTION_RIGHT: eventName = 'throwoutright'; break;\n                    case Card.DIRECTION_UP: eventName = 'throwoutup'; break;\n                    case Card.DIRECTION_DOWN: eventName = 'throwoutdown'; break;\n                }\n\n                eventEmitter.trigger(eventName, {\n                    target: targetElement,\n                    throwDirection: lastThrow.direction\n                });\n\n            } else {\n                throw new Error('Invalid throw event.');\n            }\n        };\n    };\n\n    construct();\n\n    /**\n     * Alias\n     */\n    card.on = eventEmitter.on;\n    card.trigger = eventEmitter.trigger;\n\n    /**\n     * Throws a card into the stack from an arbitrary position.\n     *\n     * @param {Number} fromX\n     * @param {Number} fromY\n     * @return {undefined}\n     */\n    card.throwIn = (fromX, fromY) => {\n        throwWhere(Card.THROW_IN, fromX, fromY);\n    };\n\n    /**\n     * Throws a card out of the stack in the direction away from the original offset.\n     *\n     * @param {Number} fromX\n     * @param {Number} fromY\n     * @return {undefined}\n     */\n    card.throwOut = (fromX, fromY) => {\n        throwWhere(Card.THROW_OUT, fromX, fromY);\n    };\n\n    /**\n     * Unbinds all Hammer.Manager events.\n     * Removes the listeners from the physics simulation.\n     *\n     * @return {undefined}\n     */\n    card.destroy = () => {\n        mc.destroy();\n        springThrowIn.destroy();\n        springThrowOut.destroy();\n\n        stack.destroyCard(card);\n    };\n\n    return card;\n};\n\n/**\n * Creates a configuration object.\n *\n * @param {Object} config\n * @return {Object}\n */\nCard.makeConfig = (config = {}) => {\n    const defaultConfig = {\n        isThrowOut: Card.isThrowOut,\n        throwOutConfidence: Card.throwOutConfidence,\n        throwOutDistance: Card.throwOutDistance,\n        minThrowOutDistance: 400,\n        maxThrowOutDistance: 500,\n        rotation: Card.rotation,\n        maxRotation: 20,\n        transform: Card.transform\n    };\n\n    return _.assign({}, defaultConfig, config);\n};\n\n/**\n * Uses CSS transform to translate element position and rotation.\n *\n * Invoked in the event of `dragmove` and every time the physics solver is triggered.\n *\n * @param {HTMLElement} element\n * @param {Number} x Horizontal offset from the startDrag.\n * @param {Number} y Vertical offset from the startDrag.\n * @param {Number} r\n * @return {undefined}\n */\nCard.transform = (element, x, y, r) => {\n    element.style[vendorPrefix('transform')] = `translate3d(0, 0, 0) translate(${x}px, ${y}px) rotate(${r}deg)`;\n};\n\n/**\n * Append element to the parentNode.\n *\n * This makes the element first among the siblings. The reason for using\n * this as opposed to zIndex is to allow CSS selector :nth-child.\n *\n * Invoked in the event of mousedown.\n * Invoked when card is added to the stack.\n *\n * @param {HTMLElement} element The target element.\n * @return {undefined}\n */\nCard.appendToParent = (element) => {\n    const parentNode = element.parentNode;\n    const siblings = elementChildren(parentNode);\n    const targetIndex = siblings.indexOf(element);\n\n    if (targetIndex + 1 !== siblings.length) {\n        parentNode.removeChild(element);\n        parentNode.appendChild(element);\n    }\n};\n\n/**\n * Returns a value between 0 and 1 indicating the completeness of the throw out condition.\n *\n * Ration of the absolute distance from the original card position and element width.\n *\n * @param {Number} x horizontal distance from the dragStart.\n * @param {Number} y vertical distance from the dragStart.\n * @param {HTMLElement} element Element.\n * @return {Number}\n */\nCard.throwOutConfidence = (x, y, element) => {\n\n    let xConf = Math.min(Math.abs(x) / element.offsetWidth, 1);\n    let yConf = Math.min(Math.abs(y) / element.offsetHeight, 1);\n\n    return Math.max(xConf, yConf);\n\n};\n\n/**\n * Determines if element is being thrown out of the stack.\n *\n * Element is considered to be thrown out when throwOutConfidence is equal to 1.\n *\n * @param {Number} offset Distance from the dragStart.\n * @param {HTMLElement} element Element.\n * @param {Number} throwOutConfidence config.throwOutConfidence\n * @return {Boolean}\n */\nCard.isThrowOut = (offset, element, throwOutConfidence) => {\n    return throwOutConfidence === 1;\n};\n\n/**\n * Calculates a distances at which the card is thrown out of the stack.\n *\n * @param {Number} min\n * @param {Number} max\n * @return {Number}\n */\nCard.throwOutDistance = (min, max) => {\n    return _.random(min, max);\n};\n\n/**\n * Calculates rotation based on the element x and y offset, element width and maxRotation variables.\n *\n * @param {Number} x Horizontal offset from the startDrag.\n * @param {Number} y Vertical offset from the startDrag.\n * @param {HTMLElement} element Element.\n * @param {Number} maxRotation\n * @return {Number} Rotation angle expressed in degrees.\n */\nCard.rotation = (x, y, element, maxRotation) => {\n    const horizontalOffset = Math.min(Math.max(x / element.offsetWidth, -1), 1);\n    const verticalOffset = (y > 0 ? 1 : -1) * Math.min(Math.abs(y) / 100, 1);\n    const rotation = horizontalOffset * verticalOffset * maxRotation;\n\n    return rotation;\n};\n\nCard.DIRECTION_LEFT = -1;\nCard.DIRECTION_RIGHT = 1;\nCard.DIRECTION_UP = -2;\nCard.DIRECTION_DOWN = 2;\n\nCard.THROW_IN = 'in';\nCard.THROW_OUT = 'out';\n\nexport default Card;\n"]}